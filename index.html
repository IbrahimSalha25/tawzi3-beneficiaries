<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ุชูุฒูุน - ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุงุนุฏุงุช ุงูุฅูุณุงููุฉ" />
    <meta name="theme-color" content="#3cd37a" />
    <title>ุชูุฒูุน - Tawzi3</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- ============ Toast Container ============ -->
    <div class="toast-container" id="toast-container"></div>

    <!-- ============ Splash Screen ============ -->
    <div id="splash-screen">
      <div class="splash-logo">๐ฆ</div>
      <h1>ุชูุฒูุน</h1>
      <p>ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุงุนุฏุงุช ุงูุฅูุณุงููุฉ</p>
      <div class="splash-spinner"></div>
    </div>

    <!-- ============ Login Screen ============ -->
    <div id="login-screen">
      <div class="login-container">
        <div class="login-logo">๐ฆ</div>
        <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
        <p class="login-subtitle">ุฃุฏุฎู ุจูุงูุงุชู ูููุตูู ุฅูู ุญุณุงุจู</p>

        <div class="error-message" id="login-error"></div>

        <form id="login-form">
          <div class="input-group">
            <label for="national-id">ุฑูู ุงููููุฉ</label>
            <input
              type="text"
              id="national-id"
              placeholder="ุฃุฏุฎู ุฑูู ุงููููุฉ"
              required
              autocomplete="username"
            />
          </div>
          <div class="input-group">
            <label for="credential">ุฑูู ุงููุงุชู ุฃู ูููุฉ ุงููุฑูุฑ</label>
            <input
              type="text"
              id="credential"
              placeholder="ุฃุฏุฎู ุฑูู ุงููุงุชู ุฃู ูููุฉ ุงููุฑูุฑ"
              required
              autocomplete="current-password"
            />
          </div>
          <button type="submit" class="btn" id="login-btn">ุชุณุฌูู ุงูุฏุฎูู</button>
          <div class="spinner hidden" id="login-spinner"></div>
        </form>
      </div>
    </div>

    <!-- ============ Main Application ============ -->
    <div id="app">
      <!-- Header -->
      <header>
        <div class="header-brand">
          <span class="header-brand-icon">๐ฆ</span>
          <h1>ุชูุฒูุน</h1>
        </div>
        <div class="header-actions">
          <button class="icon-btn" id="qr-btn" title="ุนุฑุถ ุฑูุฒ QR">๐ท</button>
        </div>
      </header>

      <!-- Navigation -->
      <nav>
        <button class="nav-btn active" data-section="info">
          <span class="nav-icon">๐ค</span>
          <span>ุงููุนูููุงุช</span>
        </button>
        <button class="nav-btn" data-section="parcels">
          <span class="nav-icon">๐ฆ</span>
          <span>ุงูุทุฑูุฏ</span>
        </button>
        <button class="nav-btn" data-section="settings">
          <span class="nav-icon">โ๏ธ</span>
          <span>ุงูุฅุนุฏุงุฏุงุช</span>
        </button>
      </nav>

      <!-- Content Area -->
      <div class="content">
        <!-- ======== Beneficiary Info Section ======== -->
        <div id="info" class="section active">
          <div class="spinner" id="info-spinner"></div>
          <div id="info-content" class="hidden">
            <!-- Profile Header -->
            <div class="card profile-header">
              <div class="profile-avatar">๐ค</div>
              <div class="profile-name" id="profile-name">---</div>
              <div class="profile-id" id="profile-id-display">---</div>
            </div>

            <!-- Camp Info -->
            <div class="card">
              <div class="card-title">
                <span class="card-icon">๐๏ธ</span>
                ูุนูููุงุช ุงููุฎูู
              </div>
              <div class="info-row">
                <span class="info-label">ุงุณู ุงููุฎูู</span>
                <span class="info-value" id="camp-name">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ุงููููุน</span>
                <span class="info-value" id="camp-location">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ุงุณู ุงูููุฏูุจ</span>
                <span class="info-value" id="camp-representative">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ูุงุชู ุงูููุฏูุจ</span>
                <span class="info-value" id="camp-rep-phone">---</span>
              </div>
            </div>

            <!-- Personal Info -->
            <div class="card">
              <div class="card-title">
                <span class="card-icon">๐ชช</span>
                ุงููุนูููุงุช ุงูุดุฎุตูุฉ
              </div>
              <div class="info-row">
                <span class="info-label">ุงูุงุณู ุงููุงูู</span>
                <span class="info-value" id="head-name">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ุฑูู ุงููููุฉ</span>
                <span class="info-value" id="head-id">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ุฑูู ุงููุงุชู</span>
                <span class="info-value" id="head-phone">---</span>
              </div>
            </div>

            <!-- Family Composition -->
            <div class="card">
              <div class="card-title">
                <span class="card-icon">๐จโ๐ฉโ๐งโ๐ฆ</span>
                ุชูููู ุงูุฃุณุฑุฉ
              </div>
              <div class="family-grid">
                <div class="family-stat family-total">
                  <div class="stat-value" id="family-total">0</div>
                  <div class="stat-label">ุฅุฌูุงูู ุฃูุฑุงุฏ ุงูุฃุณุฑุฉ</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="males-0-2">0</div>
                  <div class="stat-label">ุฐููุฑ 0-2</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="females-0-2">0</div>
                  <div class="stat-label">ุฅูุงุซ 0-2</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="males-5-17">0</div>
                  <div class="stat-label">ุฐููุฑ 5-17</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="females-5-17">0</div>
                  <div class="stat-label">ุฅูุงุซ 5-17</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="males-17-60">0</div>
                  <div class="stat-label">ุฐููุฑ 17-60</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="females-17-60">0</div>
                  <div class="stat-label">ุฅูุงุซ 17-60</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="males-60-plus">0</div>
                  <div class="stat-label">ุฐููุฑ 60+</div>
                </div>
                <div class="family-stat">
                  <div class="stat-value" id="females-60-plus">0</div>
                  <div class="stat-label">ุฅูุงุซ 60+</div>
                </div>
                <div class="family-stat" style="grid-column: 1 / -1">
                  <div class="stat-value" id="disabled-count">0</div>
                  <div class="stat-label">ุฐูู ุงูุฅุนุงูุฉ</div>
                </div>
              </div>
            </div>

            <!-- Original Location -->
            <div class="card">
              <div class="card-title">
                <span class="card-icon">๐</span>
                ุงููููุน ุงูุฃุตูู
              </div>
              <div class="info-row">
                <span class="info-label">ุงููุญุงูุธุฉ</span>
                <span class="info-value" id="governorate">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ุงูุจูุฏุฉ</span>
                <span class="info-value" id="town">---</span>
              </div>
              <div class="info-row">
                <span class="info-label">ูุนูู ุจุงุฑุฒ</span>
                <span class="info-value" id="landmark">---</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ======== Parcels Section ======== -->
        <div id="parcels" class="section">
          <div class="spinner" id="parcels-spinner"></div>
          <div id="parcels-content" class="hidden">
            <div class="parcels-grid" id="parcels-grid"></div>
          </div>
        </div>

        <!-- ======== Settings Section ======== -->
        <div id="settings" class="section">
          <div class="settings-list">
            <div class="setting-item">
              <div class="setting-icon">๐ค</div>
              <span class="setting-label" id="user-name-display"
                >ุงุณู ุงููุณุชููุฏ</span
              >
            </div>

            <div class="setting-item" id="theme-toggle">
              <div class="setting-icon">๐</div>
              <span class="setting-label">ุงููุถุน ุงููููู</span>
              <div class="toggle-switch" id="theme-switch"></div>
            </div>

            <div class="setting-item" id="complaint-btn">
              <div class="setting-icon">๐</div>
              <span class="setting-label">ุชูุฏูู ุดููู</span>
              <span class="setting-arrow">โ</span>
            </div>

            <div class="setting-item" id="change-password-btn">
              <div class="setting-icon">๐</div>
              <span class="setting-label">ุชุบููุฑ ูููุฉ ุงููุฑูุฑ</span>
              <span class="setting-arrow">โ</span>
            </div>

            <div class="setting-item danger" id="logout-btn">
              <div class="setting-icon">๐ช</div>
              <span class="setting-label">ุชุณุฌูู ุงูุฎุฑูุฌ</span>
              <span class="setting-arrow">โ</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ MODALS ============ -->

    <!-- QR Code Modal -->
    <div class="modal-overlay" id="qr-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">๐ท ุฑูุฒ QR ุงูุฎุงุต ุจู</h3>
          <button class="close-btn" onclick="closeModal('qr-modal')">โ</button>
        </div>
        <div class="qr-container">
          <div class="qr-box" id="qr-code"></div>
          <p class="qr-name" id="qr-name"></p>
          <p class="qr-id" id="qr-id-text"></p>
        </div>
      </div>
    </div>

    <!-- Parcel Details Modal -->
    <div class="modal-overlay" id="parcel-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">๐ฆ ุชูุงุตูู ุงูุทุฑุฏ</h3>
          <button class="close-btn" onclick="closeModal('parcel-modal')">
            โ
          </button>
        </div>
        <div class="card">
          <div class="card-title">
            <span class="card-icon">๐</span>
            ูุนูููุงุช ุงูุทุฑุฏ
          </div>
          <div class="info-row">
            <span class="info-label">ุงุณู ุงูุทุฑุฏ</span>
            <span class="info-value" id="detail-parcel-name">---</span>
          </div>
          <div class="info-row">
            <span class="info-label">ุงูููุน</span>
            <span class="info-value" id="detail-parcel-type">---</span>
          </div>
          <div class="info-row">
            <span class="info-label">ุญุงูุฉ ุงูุทุฑุฏ</span>
            <span class="info-value" id="detail-parcel-status">---</span>
          </div>
          <div class="info-row">
            <span class="info-label">ุงูุชุงุฑูุฎ</span>
            <span class="info-value" id="detail-parcel-date">---</span>
          </div>
          <div class="info-row">
            <span class="info-label">ุงููุตู</span>
            <span class="info-value" id="detail-parcel-desc">---</span>
          </div>
        </div>
        <div class="card mt-16">
          <div class="card-title">
            <span class="card-icon">๐</span>
            ุญุงูุฉ ุงูุชูุฒูุน
          </div>
          <div class="info-row">
            <span class="info-label">ุญุงูุฉ ุงูุงุณุชูุงู</span>
            <span class="info-value" id="detail-dist-status">---</span>
          </div>
          <div class="info-row">
            <span class="info-label">ุชุงุฑูุฎ ุงูุชูุฒูุน</span>
            <span class="info-value" id="detail-dist-date">---</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Complaint Modal -->
    <div class="modal-overlay" id="complaint-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">๐ ุชูุฏูู ุดููู</h3>
          <button class="close-btn" onclick="closeModal('complaint-modal')">
            โ
          </button>
        </div>
        <div class="input-group">
          <label for="complaint-text">ูุต ุงูุดููู</label>
          <textarea
            id="complaint-text"
            placeholder="ุงูุชุจ ุดููุงู ููุง ุจุงูุชูุตูู..."
            rows="5"
          ></textarea>
        </div>
        <div class="modal-actions">
          <button
            class="btn btn-secondary"
            onclick="closeModal('complaint-modal')"
          >
            ุฅูุบุงุก
          </button>
          <button
            class="btn"
            id="submit-complaint-btn"
            onclick="submitComplaint()"
          >
            ุฅุฑุณุงู ุงูุดููู
          </button>
        </div>
      </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal-overlay" id="password-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">๐ ุชุบููุฑ ูููุฉ ุงููุฑูุฑ</h3>
          <button class="close-btn" onclick="closeModal('password-modal')">
            โ
          </button>
        </div>

        <!-- Step 1: Verify current credential -->
        <div id="password-step-verify" class="password-step">
          <div class="password-info" id="password-info-text">
            ุฃุฏุฎู ุงูุจูุงูุงุช ููุชุญูู ูู ูููุชู
          </div>
          <div class="input-group">
            <label for="verify-input" id="verify-label">ุงูุชุญูู</label>
            <input type="text" id="verify-input" placeholder="ุฃุฏุฎู ุงูุจูุงูุงุช" />
          </div>
          <div class="modal-actions">
            <button
              class="btn btn-secondary"
              onclick="closeModal('password-modal')"
            >
              ุฅูุบุงุก
            </button>
            <button
              class="btn"
              id="verify-btn"
              onclick="verifyCurrentCredential()"
            >
              ุชุญูู
            </button>
          </div>
        </div>

        <!-- Step 2: Set new password -->
        <div id="password-step-new" class="password-step">
          <div class="password-info">ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ</div>
          <div class="input-group">
            <label for="new-password-input">ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ</label>
            <input
              type="password"
              id="new-password-input"
              placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ (6 ุฃุญุฑู ุนูู ุงูุฃูู)"
            />
          </div>
          <div class="input-group">
            <label for="confirm-password-input">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ</label>
            <input
              type="password"
              id="confirm-password-input"
              placeholder="ุฃุนุฏ ุฅุฏุฎุงู ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ"
            />
          </div>
          <div class="modal-actions">
            <button
              class="btn btn-secondary"
              onclick="closeModal('password-modal')"
            >
              ุฅูุบุงุก
            </button>
            <button
              class="btn"
              id="save-password-btn"
              onclick="saveNewPassword()"
            >
              ุญูุธ ูููุฉ ุงููุฑูุฑ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ External Scripts ============ -->
    <!-- Firebase SDK (CDN compat) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- App Modules (order matters: config โ auth โ data โ main) -->
    <script src="js/firebaseConfig.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/beneficiary.js"></script>
    <script src="js/parcels.js"></script>
    <script src="js/complaints.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
